<main>
  <section class="demo-sections">
    
    <p>使用FF36+ <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Browser_compatibility">compatibility table</a></p>

    <div>
      <button type="button" class="snap">截图</button>
    </div>
  </section>

  <section class="demo-sections">
    <video style="width: 450px; height: 350px;" autoplay></video>
    <canvas width="450" height="350"></canvas>
  </section>
</main>

<script>
  (function() {
    if (!navigator.mediaDevices) {
      console.log('Error! Use FF36+');
      return;
    }

    var video = document.querySelector('video');
    var canvas = document.querySelector('canvas');
    var ctx = canvas.getContext('2d');

    // list media devices
    var devices = navigator.mediaDevices.enumerateDevices();

    devices.then(function(devices) {
      devices.forEach(function(device) {
        console.log(device.kind + ": " + device.label + " id = " + device.deviceId);
      });
    }).catch(function(err) {
      console.log(err.name + ": " + err.message);
    });

    // use
    var p = navigator.mediaDevices.getUserMedia({ video: true });

    p.then(function(stream) {
      var imgURL = window.URL.createObjectURL(stream);

      video.src = imgURL;

      video.onloadedmetadata = function(e) {
        window.URL.revokeObjectURL(imgURL);
      };
    }).catch(function(err) {
      console.log(err.name + ": " + err.message);
    });

    // snap
    document.querySelector('.snap').onclick = function(e) {
      e.preventDefault();

      ctx.drawImage(video, 0, 0, 450, 350);
    }
  })();
</script>